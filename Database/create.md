# MyUniversity DB

```
DROP DATABASE IF EXISTS MyUniversity;

CREATE DATABASE MyUniversity;

USE MyUniversity;

CREATE TABLE DIPARTIMENTO (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(60) NOT NULL,
    UNIQUE(NOME),
    EDIFICIO VARCHAR(20) NOT NULL
);

CREATE TABLE ESAME (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(60) NOT NULL,
    CFU INT NOT NULL,
    ORE_TEORIA INT NOT NULL,
    ORE_LABORATORIO INT NOT NULL,
    ID_DIPARTIMENTO INT NOT NULL,
    FOREIGN KEY(ID_DIPARTIMENTO) REFERENCES DIPARTIMENTO(ID)
);

CREATE TABLE STUDENTE (
    MATRICOLA CHAR(10) PRIMARY KEY,
    NOME VARCHAR(50) NOT NULL,
    COGNOME VARCHAR(50) NOT NULL,
    INDIRIZZO VARCHAR(100) NOT NULL,
    CELLULARE CHAR(10) NOT NULL,
    DATA_DI_NASCITA TIMESTAMP NOT NULL,
    DATA_IMMATRICOLAZIONE TIMESTAMP NOT NULL,
    ID_DIPARTIMENTO INT NOT NULL,
    FOREIGN KEY(ID_DIPARTIMENTO) REFERENCES DIPARTIMENTO(ID)
);

CREATE TABLE CREDENZIALI (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    USERNAME VARCHAR(60) NOT NULL,
    PASSWORD VARCHAR(60) NOT NULL,
    MATRICOLA_STUDENTE CHAR(10),
    FOREIGN KEY(MATRICOLA_STUDENTE) REFERENCES STUDENTE(MATRICOLA)
);

CREATE TABLE STUDENTE_ESAME (
    ID INT PRIMARY KEY AUTO_INCREMENT,
    MATRICOLA_STUDENTE CHAR(10) NOT NULL,
    ID_ESAME INT NOT NULL,
    FOREIGN KEY (MATRICOLA_STUDENTE) REFERENCES STUDENTE(MATRICOLA),
    FOREIGN KEY (ID_ESAME) REFERENCES ESAME(ID)
);

DELIMITER //

CREATE PROCEDURE AggiungiStudenteEsame (
    IN studente_matricola CHAR(10),
    IN esame_id INT
)
BEGIN
    DECLARE studente_dipartimento INT;
    DECLARE esame_dipartimento INT;
    DECLARE esame_presente INT;

    -- Ottieni il dipartimento dello studente
    SELECT ID_DIPARTIMENTO INTO studente_dipartimento
    FROM STUDENTE
    WHERE MATRICOLA = studente_matricola;

    -- Ottieni il dipartimento dell'esame
    SELECT ID_DIPARTIMENTO INTO esame_dipartimento
    FROM ESAME
    WHERE ID = esame_id;

    -- Controlla se i dipartimenti sono diversi e lancia un messaggio di errore
    IF studente_dipartimento != esame_dipartimento THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Lo studente e l''esame appartengono a dipartimenti diversi!';
    ELSE
        SELECT COUNT(*) INTO esame_presente
        FROM STUDENTE_ESAME
        WHERE MATRICOLA_STUDENTE = studente_matricola AND ID_ESAME = esame_id;

        IF esame_presente > 0 THEN
            SIGNAL SQLSTATE '45000';
        ELSE
            INSERT INTO STUDENTE_ESAME (MATRICOLA_STUDENTE, ID_ESAME)
            VALUES (studente_matricola, esame_id);
        END IF;
    END IF;
END //

DELIMITER ;
```